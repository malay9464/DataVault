<!DOCTYPE html>
<html>
<head>
    <title>User Management</title>
    <link rel="stylesheet" href="/static/css/users.css">
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;600&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>

<!-- HEADER -->
<div class="top-header">
    <div class="header-left">
        <a href="/" class="back-link">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M19 12H5M12 5l-7 7 7 7"/>
            </svg>
            Back to Files
        </a>
        <span class="header-divider">/</span>
        <span class="header-title">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/>
                <circle cx="9" cy="7" r="4"/>
                <path d="M23 21v-2a4 4 0 00-3-3.87M16 3.13a4 4 0 010 7.75"/>
            </svg>
            User Management
        </span>
    </div>
    <button class="logout-btn" onclick="logout()">
        <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4M16 17l5-5-5-5M21 12H9"/>
        </svg>
        Logout
    </button>
</div>

<!-- MAIN -->
<div class="main">

    <!-- Stats Bar -->
    <div class="stats-bar" id="statsBar">
        <div class="stat-pill">
            <span class="stat-pill-value" id="statTotal">â€”</span>
            <span class="stat-pill-label">Total Users</span>
        </div>
        <div class="stat-pill stat-pill--green">
            <span class="stat-pill-value" id="statActive">â€”</span>
            <span class="stat-pill-label">Active</span>
        </div>
        <div class="stat-pill stat-pill--red">
            <span class="stat-pill-value" id="statDisabled">â€”</span>
            <span class="stat-pill-label">Disabled</span>
        </div>
        <div class="stat-pill stat-pill--blue">
            <span class="stat-pill-value" id="statAdmins">â€”</span>
            <span class="stat-pill-label">Admins</span>
        </div>
    </div>

    <div class="card">
        <!-- Toolbar -->
        <div class="toolbar">
            <div class="search-wrap">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/>
                </svg>
                <input id="searchInput" type="text" placeholder="Search by email..." oninput="filterUsers()">
            </div>
            <div class="toolbar-right">
                <select id="roleFilter" onchange="filterUsers()" class="filter-select">
                    <option value="">All Roles</option>
                    <option value="user">User</option>
                    <option value="admin">Admin</option>
                </select>
                <select id="statusFilter" onchange="filterUsers()" class="filter-select">
                    <option value="">All Status</option>
                    <option value="active">Active</option>
                    <option value="disabled">Disabled</option>
                </select>
            </div>
        </div>

        <!-- Table -->
        <div class="table-wrap">
            <table>
                <thead>
                    <tr>
                        <th>User</th>
                        <th>Role</th>
                        <th>Status</th>
                        <th>Uploads</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="usersTable"></tbody>
            </table>
        </div>

        <div id="emptyState" class="empty-state" style="display:none;">
            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#94a3b8" stroke-width="1.5">
                <path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/>
                <circle cx="9" cy="7" r="4"/>
                <path d="M23 21v-2a4 4 0 00-3-3.87M16 3.13a4 4 0 010 7.75"/>
            </svg>
            <p>No users match your filters</p>
        </div>
    </div>
</div>

<!-- DELETE MODAL -->
<div id="deleteUserModal" class="modal-overlay" style="display:none;">
    <div class="modal-box">
        <div class="modal-icon modal-icon--danger">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="3 6 5 6 21 6"/>
                <path d="M19 6l-1 14a2 2 0 01-2 2H8a2 2 0 01-2-2L5 6"/>
                <path d="M10 11v6M14 11v6M9 6V4h6v2"/>
            </svg>
        </div>
        <h3 class="modal-title">Delete User</h3>
        <p class="modal-subtitle">What should happen to data owned by <strong id="deleteUserEmail"></strong>?</p>

        <div class="modal-options">
            <button class="modal-option modal-option--danger" onclick="confirmDeleteUser('delete_all')">
                <div class="modal-option-icon">ðŸ—‘</div>
                <div>
                    <div class="modal-option-title">Delete All Data</div>
                    <div class="modal-option-desc">Permanently removes all their uploads, records and categories</div>
                </div>
            </button>
            <button class="modal-option modal-option--blue" onclick="confirmDeleteUser('transfer')">
                <div class="modal-option-icon">ðŸ“¦</div>
                <div>
                    <div class="modal-option-title">Transfer to Admin</div>
                    <div class="modal-option-desc">Move all their data to your admin account before deleting</div>
                </div>
            </button>
        </div>

        <button class="modal-cancel" onclick="closeDeleteUserModal()">Cancel</button>
    </div>
</div>

<!-- RESET PASSWORD MODAL -->
<div id="resetPwModal" class="modal-overlay" style="display:none;">
    <div class="modal-box">
        <div class="modal-icon modal-icon--blue">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                <path d="M7 11V7a5 5 0 0110 0v4"/>
            </svg>
        </div>
        <h3 class="modal-title">Reset Password</h3>
        <p class="modal-subtitle">Set a new password for <strong id="resetPwEmail"></strong></p>

        <div class="pw-input-wrap">
            <input type="password" id="newPwInput" placeholder="Enter new password" class="pw-input">
            <button class="pw-eye" onclick="togglePwVisibility()" type="button">
                <svg id="eyeIcon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                    <circle cx="12" cy="12" r="3"/>
                </svg>
            </button>
        </div>
        <div id="pwStrengthBar" class="pw-strength-bar" style="display:none;">
            <div id="pwStrengthFill" class="pw-strength-fill"></div>
        </div>
        <div id="pwStrengthLabel" class="pw-strength-label" style="display:none;"></div>

        <div class="modal-actions">
            <button class="modal-cancel" onclick="closeResetPwModal()">Cancel</button>
            <button class="btn-primary-sm" onclick="submitResetPassword()">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M20 6L9 17l-5-5"/>
                </svg>
                Save Password
            </button>
        </div>
    </div>
</div>

<!-- TOAST -->
<div id="toastContainer" class="toast-container"></div>

<script src="/static/js/users.js"></script>
</body>
</html>